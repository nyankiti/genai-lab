
# Found out we were leaking user session tokens into logs

**Upvotes**: 208



[View on Reddit](https://www.reddit.com/r/devops/comments/1lb2v7n/found_out_we_were_leaking_user_session_tokens/)

## ポストの内容の説明

このポストは、ユーザーがアプリケーションのログにユーザーのセッショントークンが漏洩していることに気づいた経験について述べています。

**発見の経緯:**

*   別のバグのログをレビュー中に、ランダムに見える長い文字列に気付いた。
*   それらは、リクエストエラー処理中にアプリケーションログにダンプされた完全な認証トークンであることが判明した。
*   原因は、デバッグのためにリクエストオブジェクト全体をログに記録する`catch`ブロックだった。
*   認証ミドルウェアが、デコードされたトークンをそこに付加しており、機密情報が含まれていた。

**問題の深刻さ:**

*   この問題は数週間前から発生していた。
*   ログは内部限定でアクセス制御されていたため、幸いにも外部への漏洩はなかった。
*   それでも、重大な過ちである。

**解決策:**

*   他の同様のケースがないか、コードベースをスキャン（`blackbox`を使用）。
*   バックグラウンドワーカーと古い管理者用ルートで同様のケースを発見。
*   それらを修正（トークンを削除）。
*   デフォルトでエラーログからトークンを削除するミドルウェアを追加。
*   CIでこのようなログ記録を防止するための基本的なチェックを作成。

**教訓:**

*   プライベートデータがログに容易に漏洩する可能性を再認識。
*   悪意のある意図ではなく、デバッグ時の不用意なログ記録が原因である。
*   コードベースに同様の問題がないか確認することの重要性。

## ポストに対する特に興味深いコメント

いくつかのコメントが、同様の経験や関連する問題について言及しており、興味深い視点を提供しています。

*   **最初のコメント（85 upvotes）:** チームが「すべてをJSON形式でログに記録する」と決定したが、パスワードを含むキーに対する例外処理を怠ったという経験。また、GETリクエストでログイン情報（メールアドレスとパスワード）を送信するログインフォームがあり、HTTPDログが非常に危険な状態になっていたという事例を紹介しています。ログだけでなく、ログの内容を確認する重要性を強調しています。サービスのユーザーを作成し、既知のパスワードでログをスキャンするというアドバイスも提供しています。

*   **2番目のコメント（44 upvotes）:** チームがクレジットカード情報を数ヶ月間ログに記録していたという、より深刻な事例を共有しています。

*   **4番目のコメント（10 upvotes）:** 開発者がパスワードログインに関連する問題をデバッグするために、パスワードを平文でログに記録するデバッグログを追加し、それを削除し忘れたという事例を紹介しています。これにより、本番環境にユーザーのパスワードが漏洩し、パスワードのリセットを余儀なくされたという経験を述べています。この事例は、認証関連の変更に対する厳格なチェックと注意の必要性を示しています。

これらのコメントは、ログ記録における機密情報の取り扱いが、いかに容易にミスを起こしやすく、深刻な結果を招く可能性があるかを具体的に示しており、注意喚起として非常に有益です。また、ログの監視と定期的なレビューの重要性を改めて強調しています。


---

# Stages of YAML

**Upvotes**: 145



[View on Reddit](https://www.reddit.com/r/devops/comments/1lb1f7h/stages_of_yaml/)

## 1. ポストの内容の説明

このRedditのポストは、YAML（YAML Ain't Markup Language）に対する様々な感情的な「ステージ」をユーモラスに表現しています。具体的には、YAMLを扱う際に経験しがちな感情の段階を、喪失や困難に直面した際に経験する心理的プロセスになぞらえて、以下の5つの段階として示しています。

*   **否定（Denial）**: YAMLがそんなに悪いわけがないと信じようとする段階。
*   **怒り（Anger）**: インデントの間違いで全てが動かなくなったことへの怒り。
*   **交渉（Bargaining）**: YAMLを正しく書けば、もう二度と触らなくて済むかもしれないと願う段階。
*   **絶望（Depression）**: YAMLファイルを永遠に弄り続けることになるのではないかという絶望感。
*   **受容（Acceptance）**: AIがYAMLを書いてくれるようになったので、もう自分で書かなくても良いと受け入れる段階。

要するに、YAMLの扱いに苦労するプログラマーの心理状態を皮肉を込めて表現した投稿です。

## 2. 興味深いコメント

このポストに対するコメントで、特に興味深いものをいくつか紹介します。

*   **YAMLを好むユーザーのコメント**:
    *   YAMLに対する批判を理解できないという意見。 Ansible、Gitlab CI/CD、Kubernetesでの使用経験があり、問題を感じたことがないとのこと。型の表現や複数行のドキュメントの書き方について、ドキュメントを参照することで解決できると述べています。
*   **YAMLを嫌うユーザーのコメント**:
    *   Kubernetesのマニフェストで、0と設定したフィールドが未設定として扱われるなど、YAMLの型の扱いに問題があると感じている。インデントの重要性も面倒だと感じている。
    *   YAML自体が悪いのではなく、Helm ChartsのようにYAMLがプログラミング言語の代わりとして使われる場合に問題が発生すると指摘しています。
*   **YAMLの問題を解決する為の提案**:
    *   `yamllint`、`yamlfmt`/`prettier`、スキーマ検証（`check-jsonschema`またはVS CodeのYAML拡張）といったツールを活用することで、YAMLの問題を解決できるという提案。CI（継続的インテグレーション）環境での利用も推奨しています。
*   **YAML vs JSONの比較**:
    *   YAMLとJSONの比較。YAMLの方がシンプルで良いという意見と、JSONからYAMLに変換するという別の解決策を提示しているコメントもあります。

これらのコメントは、YAMLに対する様々な意見や、YAMLの扱いを楽にするための具体的な方法、そしてYAMLを使用する上での代替手段などを提示しており、議論を深める上で興味深いものと言えます。

